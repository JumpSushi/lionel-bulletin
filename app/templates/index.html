{% extends "base.html" %}

{% block title %}KGV Bulletin Email Service - Home{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-4">
            <i class="fas fa-envelope-open-text me-3"></i>
            KGV Bulletin Email Service
        </h1>
        <p class="lead mb-5">
            Stay updated with the latest KGV school announcements delivered directly to your inbox.
            Get personalized Year 9 highlights with smart filtering and AI-generated headlines.
        </p>
        <div class="d-flex gap-3 justify-content-center">
            <a href="/register" class="btn btn-light btn-lg px-5 py-3" id="hero-register">
                <i class="fas fa-user-plus me-2"></i>
                Get Started
            </a>
            <a href="/login" class="btn btn-outline-light btn-lg px-5 py-3" id="hero-login">
                <i class="fas fa-sign-in-alt me-2"></i>
                Sign In
            </a>
            <a href="/dashboard" class="btn btn-light btn-lg px-5 py-3" id="hero-dashboard" style="display: none;">
                <i class="fas fa-tachometer-alt me-2"></i>
                Dashboard
            </a>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <h4 class="card-title">Smart Filtering</h4>
                        <p class="card-text">
                            Automatically filters out donation requests and feedback forms to show you only the most relevant announcements for Year 9 students.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h4 class="card-title">AI Headlines</h4>
                        <p class="card-text">
                            Get concise, AI-generated headlines for each bulletin item to quickly understand what's important without reading through everything.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h4 class="card-title">Flexible Scheduling</h4>
                        <p class="card-text">
                            Choose to receive daily or weekly email summaries, or disable emails entirely while still accessing the web dashboard.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Benefits Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <h2 class="display-6 fw-bold mb-4">Why Choose Our Service?</h2>
                <div class="mb-4">
                    <div class="d-flex align-items-start mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-success fs-4 me-3"></i>
                        </div>
                        <div>
                            <h5>Personalized Content</h5>
                            <p class="text-muted">Only get announcements relevant to Year 9 students and general school updates.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-shield-alt text-success fs-4 me-3"></i>
                        </div>
                        <div>
                            <h5>Secure & Private</h5>
                            <p class="text-muted">Your email and preferences are securely stored with proper authentication.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-mobile-alt text-success fs-4 me-3"></i>
                        </div>
                        <div>
                            <h5>Mobile Friendly</h5>
                            <p class="text-muted">Beautiful emails and web interface that work perfectly on all devices.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-4">
                            <i class="fas fa-chart-line text-primary me-2"></i>
                            Service Statistics
                        </h5>
                        
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="stat-number text-primary" id="total-users">-</div>
                                <div class="text-muted">Active Users</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-number text-success" id="emails-sent">-</div>
                                <div class="text-muted">Emails Sent</div>
                            </div>
                            <div class="col-6">
                                <div class="stat-number text-info" id="bulletin-items">-</div>
                                <div class="text-muted">Bulletin Items</div>
                            </div>
                            <div class="col-6">
                                <div class="stat-number text-warning" id="uptime">99.9%</div>
                                <div class="text-muted">Uptime</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent Updates Preview -->
<section class="py-5" id="recent-updates" style="display: none;">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5">Recent Bulletin Updates</h2>
                <div id="recent-items-container">
                    <!-- Recent items will be loaded here -->
                </div>
                <div class="text-center mt-4">
                    <a href="/dashboard" class="btn btn-primary">
                        View All Updates
                        <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action -->
<section class="py-5 bg-primary text-white">
    <div class="container text-center">
        <h2 class="display-6 fw-bold mb-4">Ready to Get Started?</h2>
        <p class="lead mb-4">
            Join other Year 9 students who are staying informed with our bulletin email service.
        </p>
        <a href="/register" class="btn btn-light btn-lg px-5 py-3" id="cta-register">
            <i class="fas fa-rocket me-2"></i>
            Create Your Account
        </a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    updateHeroButtons();
    loadPublicStats();
    
    if (currentUser) {
        loadRecentUpdates();
    }
});

function updateHeroButtons() {
    const heroRegister = document.getElementById('hero-register');
    const heroLogin = document.getElementById('hero-login');
    const heroDashboard = document.getElementById('hero-dashboard');
    const ctaRegister = document.getElementById('cta-register');
    
    if (currentUser) {
        heroRegister.style.display = 'none';
        heroLogin.style.display = 'none';
        heroDashboard.style.display = 'inline-block';
        ctaRegister.textContent = 'Go to Dashboard';
        ctaRegister.href = '/dashboard';
        ctaRegister.innerHTML = '<i class="fas fa-tachometer-alt me-2"></i>Go to Dashboard';
    }
}

async function loadPublicStats() {
    try {
        // This would be a public endpoint showing general stats
        const stats = {
            users: 150,
            emails: 2500,
            items: 450
        };
        
        document.getElementById('total-users').textContent = stats.users;
        document.getElementById('emails-sent').textContent = stats.emails;
        document.getElementById('bulletin-items').textContent = stats.items;
    } catch (error) {
        console.error('Failed to load stats:', error);
    }
}

async function loadRecentUpdates() {
    try {
        const response = await apiCall('/bulletin/items?per_page=3');
        const items = response.items;
        
        if (items.length > 0) {
            const container = document.getElementById('recent-items-container');
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bulletin-item';
                
                itemDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <span class="badge bg-primary">Item ${index + 1}</span>
                        <small class="text-muted">${formatDate(item.created_at)}</small>
                    </div>
                    ${item.ai_headline ? `
                        <div class="headline">
                            <h6><i class="fas fa-bullhorn me-2"></i>${item.ai_headline}</h6>
                        </div>
                    ` : ''}
                    <div class="content">
                        ${item.content.substring(0, 200)}${item.content.length > 200 ? '...' : ''}
                    </div>
                `;
                
                container.appendChild(itemDiv);
            });
            
            document.getElementById('recent-updates').style.display = 'block';
        }
    } catch (error) {
        console.error('Failed to load recent updates:', error);
    }
}
</script>
{% endblock %}
